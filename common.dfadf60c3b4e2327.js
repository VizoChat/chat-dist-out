"use strict";(self.webpackChunkvizochat=self.webpackChunkvizochat||[]).push([[592],{629:(g,_,t)=>{t.d(_,{e:()=>d});var h=t(5861),s=t(529),o=t(4650),a=t(3127),m=t(5616),v=t(1697);let d=(()=>{class r{constructor(e,n,l,i){this.router=e,this.authService=n,this.http=l,this.globalServices=i,this.callbackCount=0}authValidate(){return!(!localStorage.getItem("actoken")||!localStorage.getItem("retoken"))||(this.router.navigate(["/auth/login"]),!1)}adminAuthValidate(){return!(!localStorage.getItem("adminActoken")||!localStorage.getItem("adminRetoken"))||(this.router.navigate(["/auth/login"]),!1)}setToken(e){localStorage.setItem("actoken",e.acToken),localStorage.setItem("retoken",e.reToken),this.router.navigate(["/app"])}setAdminToken(e){localStorage.setItem("adminActoken",e.acToken),localStorage.setItem("adminRetoken",e.reToken),this.router.navigate(["/admin"])}authOut(){var e=this;return(0,h.Z)(function*(){localStorage.clear(),e.userSettimeout=null,yield e.authService.signOut()})()}startSessTimout(e){let n="user"==e?"actoken":"adminActoken";if("user"==e?this.authValidate():this.adminAuthValidate())try{let i=localStorage.getItem(n),c=1e3*JSON.parse(atob(i.split(".")[1])).exp-Date.now();c>120641?this.userSettimeout=setTimeout(()=>{this.refreshAccessToken(e)},c):this.refreshAccessToken(e)}catch{this.authOut()}}refreshAccessToken(e,n){let i="user"==e?"actoken":"adminActoken",c={headers:new s.WM({"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("user"==e?"retoken":"adminRetoken")})};this.http.get(`${this.globalServices.apiUrl}/auth/generate-token`,c).subscribe(u=>{console.log(u),"ok"==u.status&&1==u.authorization?(localStorage.setItem(i,u.data.token.accessToken),this.startSessTimout(e),n&&this.callbackCount<=1&&(this.callbackCount++,n())):this.authOut()})}}return r.\u0275fac=function(e){return new(e||r)(o.LFG(a.F0),o.LFG(m.xE),o.LFG(s.eN),o.LFG(v.G))},r.\u0275prov=o.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})()},1697:(g,_,t)=>{t.d(_,{G:()=>o});var h=t(2340),s=t(4650);let o=(()=>{class a{constructor(){this.apiUrl=h.N.baseApiUrl}}return a.\u0275fac=function(v){return new(v||a)},a.\u0275prov=s.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})()}}]);